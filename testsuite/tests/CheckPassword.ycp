/**
 * Author	: Jiri Suchomel <jsuchome@suse.cz>
 * $Id$
 * Testing what is allowed for password (see bug #106714)
 */
{
    // testedfiles: Users.pm UsersSimple.pm
    import "Testsuite";
    import "Users";
    import "UsersSimple";

    map R	= $[];
    map W	= $[];
    map E	= $[
	"crack"	: "",
    ];

    define void test_ui (string username, string pw) {

	Testsuite::Test (``(UsersSimple::CheckPasswordUI ($[
	    "uid"		: username,
	    "userPassword"	: pw,
	    "type"		: "local"
	])), [R,W,E], 0);
    }

    define void test_contents (string pw) {

	Testsuite::Dump (sformat ("-------- password: %1", pw));
	string err = (string)
	    Testsuite::Test (``(UsersSimple::CheckPassword (pw, "local")),
	    [R,W,E], 0);
	if (err != "")
	    Testsuite::Dump (sformat ("-------- error: %1", err));
    }

    test_ui ("hh", "qqqqq");
    test_ui ("hh", "QQQQQ");
    test_ui ("hh", "12hh5");
    test_ui ("hh", "12345");
    test_ui ("hh", "aaaQQaaa");
    test_ui ("hh", "1a");
    Testsuite::Test (``(Users::SetEncryptionMethod ("des")), [], 0);
    test_ui ("hh", "1aaaaaaaaaaaaaaaaa");
    test_contents ("`!@#$%^&*()-=_+|");
    test_contents ("[];',./{}:\"<>");
    test_contents ("\\");
    test_contents ("");
    test_contents (nil);
    test_contents ("řšč");
}
