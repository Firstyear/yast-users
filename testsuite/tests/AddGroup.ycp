/**
 * File:
 *  AddGroup.ycp
 *
 * Module:
 *  Users configurator
 *
 * Summary:
 *  Saving group tests.
 *
 * Authors:
 *  Jiri Suchomel <jsuchome@suse.cz>
 *
 */

{

    include "testsuite.ycp";
    import "Users";
    import "UsersCache";

    Users::group_in_work = $[
	"gid":501,
    "groupname": "testgroup",
	"userlist":"hh",
	"password":"x",
    "type":`local,
	"what":`add_group];

    Users::users_by_name [`local ] = $[ "hh": 500 ];

    Users::users [`local] = $[
        500:  $[ "forename":"",
    "fullname":"",
	"gid":100,
    "groupname":"users",
	"grouplist":"audio",
	"home":"/home/hh",
	"org_home":"/home/hh",
	"password":"$1$T8$yEI1SH.1b0jqeqDq6bHha1",
	"shadow":$["inact":-1, "max":99999, "min":0, "warn":7],
	"shell":"/bin/bash",
	"surname":"",
	"uid":500,
	"username":"hh",
    "type":`local]
    ];

    Users::groups_by_name [`local] = $[];

    DUMP ( sformat ("local groups:\n %1", Users::groups [ `local ]:$[]) );

    DUMP ( sformat ("local users:\n %1\n", Users::users [ `local ]:$[]) );

    TEST(``(Users::Commit ("group", false)), [], 0);

    DUMP ( sformat ("local groups modified:\n %1",
        Users::groups [ `local ]:$[]) );

    DUMP ( sformat ("local users modified:\n %1\n",
        Users::users [ `local ]:$[]) );

    DUMP ("==========================================================");

    // with rebuilding the cache:
    DUMP ( sformat ("local group itemlist:\n %1",
        UsersCache::groups_itemlists [ `local ]:[]) );

    TEST(``(Users::Commit ("group", true)), [], 0);

    DUMP ( sformat ("local group itemlist modified:\n %1",
        UsersCache::groups_itemlists [ `local ]:[]) );
}
